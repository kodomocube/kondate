<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŒ®ç«‹ï¼†è²·ã„ç‰©ãƒªã‚¹ãƒˆãƒ¡ãƒ¼ã‚«ãƒ¼</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    <style>
        :root {
            --md-primary: #ff9ecd;
            --md-surface: #fff5f8;
            --md-secondary: #ffcc80;
            --md-salad: #c5e1a5;
            --md-soup: #ce93d8;
            --md-error: #ff5252;
        }
        body { font-family: 'Hiragino Sans', sans-serif; background: var(--md-surface); color: #5d4037; margin: 0; padding: 12px; padding-bottom: 60px; font-size: 14px; }
        .header-img-container { text-align: center; margin: 10px 0; }
        .header-img { width: 100%; max-width: 320px; border-radius: 25px; box-shadow: 0 8px 15px rgba(255, 158, 205, 0.3); }
        .card { background: #fff; padding: 16px; border-radius: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 16px; border: 2px solid #fff; }

        .details-content { padding-top: 15px; }

        button {
            position: relative; border: none; padding: 14px 20px; border-radius: 100px; font-weight: bold; width: 100%; cursor: pointer; margin-bottom: 12px; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.2); overflow: hidden; transition: transform 0.1s;
            box-shadow: 0 6px 0 rgba(0,0,0,0.1), 0 8px 15px rgba(0,0,0,0.1), inset 0 -6px 8px rgba(0,0,0,0.2), inset 0 4px 8px rgba(255,255,255,0.4);
        }
        button::after { content: ""; position: absolute; top: 4px; left: 15%; width: 70%; height: 35%; background: linear-gradient(to bottom, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 100%); border-radius: 100px; pointer-events: none; }
        button:active { transform: translateY(3px); box-shadow: 0 2px 0 rgba(0,0,0,0.1), inset 0 -3px 5px rgba(0,0,0,0.2), inset 0 4px 8px rgba(255,255,255,0.4); }

        .btn-main { background: linear-gradient(#ff9ecd, #ff69b4); }
        .btn-side { background: linear-gradient(#ffcc80, #ffa726); }
        .btn-salad { background: linear-gradient(#c5e1a5, #9ccc65); }
        .btn-soup { background: linear-gradient(#ce93d8, #ab47bc); }
        .btn-load { background: linear-gradient(#ce93d8, #ab47bc); }
        .btn-delete { background: linear-gradient(#ef9a9a, #e57373); }
        .btn-save { background: linear-gradient(#90caf9, #42a5f5); }
        .btn-csv { background: linear-gradient(#b0bec5, #78909c); }
        .btn-image { background: linear-gradient(#ff8aab, #f44336); }
        .btn-line { background: linear-gradient(#06C755, #05b34c); }
        .btn-ruby { background: linear-gradient(#80cbc4, #4db6ac); margin-bottom: 16px; }

        .glossy-card { background: #ffffff !important; border: 3px solid #fff !important; box-shadow: 0 10px 25px rgba(255, 182, 193, 0.4) !important; position: relative; }

        h2 { font-size: 1.1rem; color: #ff69b4; text-shadow: 1px 1px 0 #fff; }
        input[type="text"], select { width: 100%; padding: 12px; margin-bottom: 8px; border: 2px solid #ffe0ea; border-radius: 20px; font-size: 16px; box-sizing: border-box; background: #fff; }

        .picker-trigger {
            width: 100%; padding: 12px; margin-bottom: 12px; border: 2px solid #ffe0ea; border-radius: 20px; 
            background: #fff; text-align: left; color: #5d4037; font-size: 14px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;
        }
        .picker-trigger::after { content: "â–¼"; font-size: 10px; color: #ff9ecd; }
        .selected-tags { font-size: 0.75rem; color: #f06292; font-weight: bold; margin-top: 4px; display: block; }

        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; table-layout: fixed; }
        th.day-header { width: 35px; background: #ff9ecd; color: white; border-radius: 15px 0 0 15px; text-shadow: 1px 1px 0 rgba(0,0,0,0.1); }
        td.menu-content { padding: 8px; background: white; border-radius: 0 15px 15px 0; border: 2px solid #fff; }
        
        .day-row-0 th.day-header { background-color: #fdd835 !important; }
        .day-row-1 th.day-header { background-color: #ef5350 !important; }
        .day-row-2 th.day-header { background-color: #4fc3f7 !important; }
        .day-row-3 th.day-header { background-color: #81c784 !important; }
        .day-row-4 th.day-header { background-color: #f06292 !important; }
        .day-row-5 th.day-header { background-color: #5c6bc0 !important; }
        .day-row-6 th.day-header { background-color: #d32f2f !important; }

        .dish-section { margin-bottom: 12px; padding: 8px; background: #fff9fb; border-radius: 15px; border: 1px solid #ffebee; }
        .dish-header-row { display: flex; flex-wrap: wrap; align-items: center; gap: 8px; margin-bottom: 4px; }
        
        .dish-type-label { font-size: 0.6rem; font-weight: bold; padding: 2px 8px; border-radius: 20px; color: white; text-align: center; min-width: 40px; }
        .label-main { background-color: #f06292; }
        .label-side { background-color: #ffb74d; }
        .label-salad { background-color: #aed581; }
        .label-soup { background-color: #9575cd; }

        .fix-btn { font-size: 0.6rem; padding: 4px 10px; border-radius: 20px; border: 1px solid #ffc1e3; background: #fff; color: #f06292; font-weight: bold; min-width: 60px; text-align: center; cursor: pointer; }
        .fix-btn.fixed { background: #f06292; color: #fff; }
        
        .menu-select { width: 100% !important; flex: 0 0 100%; margin-top: 4px; padding: 8px; font-size: 0.9rem; border: 1px solid #ffd1dc; border-radius: 10px; color: #880e4f; background: #fff; box-sizing: border-box; }
        .search-link { text-decoration: none; font-size: 0.65rem; background: #fff; padding: 3px 8px; border-radius: 10px; color: #f06292; border: 1px solid #ffc1e3; font-weight: bold; white-space: nowrap; }

        #shoppingListBody { list-style: none; padding: 0; }
        #shoppingListBody li { background: #fff; margin-bottom: 8px; padding: 12px; border-radius: 20px; border: 2px solid #fff; box-shadow: 0 4px 8px rgba(255,182,193,0.3); display: flex; align-items: center; justify-content: space-between; color: #d81b60; font-weight: bold; cursor: pointer; transition: background 0.2s; }
        #shoppingListBody li.checked { background: #eeeeee !important; color: #9e9e9e !important; text-decoration: line-through; box-shadow: none; border: 2px solid #ddd; }
        #shoppingListBody li.checked .batch-tag { background: #bdbdbd !important; color: #fff !important; }

        .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 12px; }
        .scroll-list { max-height: 200px; overflow-y: auto; border: 2px solid #ffe0ea; border-radius: 18px; padding: 8px; background: #fff; margin-bottom: 12px; }
        .list-item { background: #fffaf0; border: 1px solid #ffecb3; border-radius: 15px; padding: 8px; margin-bottom: 6px; display: flex; align-items: flex-start; gap: 8px; border-left: 6px solid #ffcc80; }

        /* ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆè¡¨ç¤º */
        .compact-mode#planCard .dish-section { display: none !important; }
        .compact-mode#planCard .drop-row { display: flex; margin-bottom: 4px; }
        .compact-mode#planCard .drop-row:last-child { margin-bottom: 0; }
        
        #planCard:not(.compact-mode) .drop-row { display: none !important; }

        .compact-mode#planCard table { border-spacing: 0; border: 1px solid #ffd1dc; border-radius: 15px; overflow: hidden; background: #fff; }
        .compact-mode#planCard th.day-header { width: 35px; font-size: 14px; border-radius: 0; border-right: 1px solid #ffd1dc; color: white !important; }
        .compact-mode#planCard td.menu-content { padding: 4px 8px; border-radius: 0; border-bottom: 2px solid #ffe0ea; display: flex; flex-direction: column; background: #fff !important; }
        
        .drop-row { gap: 4px; width: 100%; }
        .drop-badge { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 4px 4px; border-radius: 12px; color: white !important; flex: 1; min-height: 40px; position: relative; text-align: center; overflow: hidden; border: 1px solid rgba(0,0,0,0.1); cursor: pointer; }
        .drop-badge .dish-name { font-size: 11px; font-weight: bold; line-height: 1.1; margin-bottom: 2px; }
        .drop-badge .dish-ings { font-size: 8px; line-height: 1; opacity: 0.9; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 95%; }
        
        .toggle-compact-btn { width: auto; padding: 6px 12px; font-size: 0.7rem; margin-bottom: 0; background: linear-gradient(#f06292, #e91e63); display: inline-block; vertical-align: middle; }
        
        #dishPickerOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: none; justify-content: center; align-items: flex-end; }
        #dishPickerContent { background: white; width: 100%; max-width: 500px; border-radius: 25px 25px 0 0; padding: 20px; box-sizing: border-box; max-height: 85%; overflow-y: auto; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .picker-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .picker-btn { background: #fff; border: 2px solid #ffe0ea; padding: 12px; border-radius: 15px; text-align: center; color: #5d4037; font-weight: bold; cursor: pointer; word-break: break-all; }
        .picker-btn.selected { background: #ff9ecd; color: white; border-color: #ff9ecd; }
        
        ruby rt { font-size: 0.6em; color: #ff69b4; font-weight: normal; }
    </style>
</head>
<body>

    <div class="header-img-container"><img src="cookingtitle.png" alt="Kodomo Cube" class="header-img"></div>
    <h1 style="text-align:center; color:#ff69b4; font-size:1.4rem; margin:10px 0; text-shadow: 2px 2px 0 #fff;">ğŸ€ çŒ®ç«‹ï¼†è²·ã„ç‰©ãƒªã‚¹ãƒˆãƒ¡ãƒ¼ã‚«ãƒ¼</h1>

    <div class="card">
        <button class="btn-ruby" id="rubyToggleBtn" onclick="toggleRuby()">ğŸ“› ãµã‚ŠãŒãªãƒ¢ãƒ¼ãƒ‰: OFF</button>
        <details><summary><h2 style="display:inline">ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†</h2></summary>
            <div class="details-content">
                <select id="profileSelect"></select>
                <div class="btn-row">
                    <button class="btn-load" onclick="loadProfile()">èª­ã¿è¾¼ã‚€</button>
                    <button class="btn-delete" onclick="deleteProfile()">å‰Šé™¤</button>
                </div>
                <hr style="border:0; border-top:2px dashed #ffe0ea; margin:12px 0;">
                <input type="text" id="profileName" placeholder="æ–°è¦ä¿å­˜å">
                <button class="btn-save" onclick="saveProfile()">ä¿å­˜</button>
            </div>
        </details>
    </div>

    <div class="card">
        <details><summary><h2 style="display:inline">æ–™ç†ã®ç™»éŒ²</h2></summary>
            <div class="details-content">
                <div class="btn-row"><input type="text" id="addName" placeholder="æ–™ç†å"><input type="text" id="addIng" placeholder="ææ–™"></div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:8px;">
                    <button class="btn-main" onclick="addDish('main')">ä¸»èœè¿½åŠ </button>
                    <button class="btn-side" onclick="addDish('side')">å‰¯èœè¿½åŠ </button>
                    <button class="btn-salad" onclick="addDish('salad')">ã‚µãƒ©ãƒ€è¿½åŠ </button>
                    <button class="btn-soup" onclick="addDish('soup')">ã‚¹ãƒ¼ãƒ—è¿½åŠ </button>
                </div>
                <label>ä¸»èœ</label><div id="mainListDisplay" class="scroll-list"></div>
                <label>å‰¯èœ</label><div id="sideListDisplay" class="scroll-list"></div>
                <label>ã‚µãƒ©ãƒ€</label><div id="saladListDisplay" class="scroll-list"></div>
                <label>ã‚¹ãƒ¼ãƒ—</label><div id="soupListDisplay" class="scroll-list"></div>
            </div>
        </details>
    </div>

    <div class="card">
        <h2>ä½œæˆæ¡ä»¶</h2>
        <label>ğŸ  åœ¨åº«ãŒã‚ã‚‹é£Ÿæ</label>
        <div class="picker-trigger" onclick="openMultiPicker('inventory')">
            <div>é¸æŠã™ã‚‹<span id="inventoryLabel" class="selected-tags"></span></div>
        </div>

        <div style="background: #fff0f5; border: 2px solid #ffe0ea; border-radius: 20px; padding: 12px; margin: 10px 0;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                <span>åœ¨åº«é£Ÿæã‚’å„ªå…ˆæ´»ç”¨</span><input type="checkbox" id="priorityMode" checked>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span>å‰¯èœ: ä½œã‚Šç½®ãæ—¥æ•°</span>
                <select id="sideBatchDays" style="width: auto; margin-bottom: 0;">
                    <option value="1">1æ—¥ (æ¯æ—¥å¤‰ãˆã‚‹)</option>
                    <option value="3" selected>3æ—¥</option>
                    <option value="7">7æ—¥</option>
                </select>
            </div>
        </div>
        
        <label>â­•ï¸ é£Ÿã¹ãŸã„æ–™ç†</label>
        <div class="picker-trigger" onclick="openMultiPicker('want')">
            <div>é¸æŠã™ã‚‹<span id="wantLabel" class="selected-tags"></span></div>
        </div>

        <label>âŒ é£Ÿã¹ãŸããªã„æ–™ç†</label>
        <div class="picker-trigger" onclick="openMultiPicker('exclude')">
            <div>é¸æŠã™ã‚‹<span id="excludeLabel" class="selected-tags"></span></div>
        </div>

        <button class="btn-main" style="height:70px; font-size:1.1rem;" onclick="generatePlan()">å›ºå®šã—ã¦ã„ãªã„çŒ®ç«‹ã‚’è‡ªå‹•ä½œæˆ</button>
    </div>

    <div class="card glossy-card compact-mode" id="planCard">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h2 style="margin:0;">ğŸ“… ä»Šé€±ã®çŒ®ç«‹</h2>
            <button class="toggle-compact-btn" onclick="toggleCompact()">è©³ç´°è¡¨ç¤ºã«ã™ã‚‹</button>
        </div>
        <table><tbody id="planBody"></tbody></table>
        <div class="btn-row">
            <button class="btn-image" onclick="saveAsImage('planCard', 'ä»Šé€±ã®çŒ®ç«‹')">ç”»åƒä¿å­˜</button>
            <button class="btn-save" onclick="copyText('planBody')">ãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ”ãƒ¼</button>
        </div>
    </div>

    <div class="card glossy-card" id="shoppingListCard">
        <h2>ğŸ›’ è²·ã„ç‰©ãƒªã‚¹ãƒˆ</h2>
        <ul id="shoppingListBody"></ul>
        <button class="btn-line" onclick="sendToLine()">LINEã§é€ã‚‹</button>
    </div>

    <div id="dishPickerOverlay" onclick="closeDishPicker()">
        <div id="dishPickerContent" onclick="event.stopPropagation()">
            <div id="pickerTitle" style="text-align:center; font-weight:bold; margin-bottom:15px; color:#ff69b4;"></div>
            <div id="pickerFixArea"></div>
            <div class="picker-grid" id="pickerGrid"></div>
            <button class="btn-delete" style="margin-top:20px;" onclick="closeDishPicker()">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <script>
        const STORAGE_KEY_DATA = 'Kondate_V60_Data';
        const DAYS = ["æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ", "æ—¥"];
        let isRubyOn = false;

        const RUBY_DICT = {
            "æœˆ": "ã’ã¤", "ç«": "ã‹", "æ°´": "ã™ã„", "æœ¨": "ã‚‚ã", "é‡‘": "ãã‚“", "åœŸ": "ã©", "æ—¥": "ã«ã¡",
            "ä¸»èœ": "ã—ã‚…ã•ã„", "å‰¯èœ": "ãµãã•ã„", "çŒ®ç«‹": "ã“ã‚“ã ã¦", "åœ¨åº«": "ã–ã„ã“", "é£Ÿæ": "ã—ã‚‡ãã–ã„",
            "æ–™ç†": "ã‚Šã‚‡ã†ã‚Š", "è²·ã„ç‰©": "ã‹ã„ã‚‚ã®", "æ´»ç”¨": "ã‹ã¤ã‚ˆã†", "å›ºå®š": "ã“ã¦ã„", "ä½œæˆ": "ã•ãã›ã„"
        };

        function addRuby(text) {
            if (!isRubyOn) return text;
            let result = text;
            for (const [kanji, yomi] of Object.entries(RUBY_DICT)) {
                const reg = new RegExp(kanji, 'g');
                result = result.replace(reg, `<ruby>${kanji}<rt>${yomi}</rt></ruby>`);
            }
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã®ã€Œæ¼¢å­—(ã‚ˆã¿)ã€å½¢å¼ã«ã‚‚å¯¾å¿œ
            return result.replace(/([ä¸€-é¾ ]+)\(([^)]+)\)/g, '<ruby>$1<rt>$2</rt></ruby>');
        }

        function toggleRuby() {
            isRubyOn = !isRubyOn;
            document.getElementById('rubyToggleBtn').innerText = `ğŸ“› ãµã‚ŠãŒãªãƒ¢ãƒ¼ãƒ‰: ${isRubyOn ? 'ON' : 'OFF'}`;
            renderTable();
            renderAll();
        }

        let selectedInv = new Set(), selectedWant = new Set(), selectedExclude = new Set();
        let data = JSON.parse(localStorage.getItem(STORAGE_KEY_DATA)) || { mains:[], sides:[], salads:[], soups:[], currentPlan: Array.from({length: 7}, () => ({ main: "", side: "", salad: "", soup: "", mainFixed: false, sideFixed: false, saladFixed: false, soupFixed: false })) };

        function renderAll() {
            ['main', 'side', 'salad', 'soup'].forEach(t => {
                const list = data[t + 's'];
                document.getElementById(t + 'ListDisplay').innerHTML = list.map((d, i) => `<div class="list-item"><span>${addRuby(d.name)}</span><span style="color:red" onclick="deleteDish('${t}',${i})">âœ•</span></div>`).join('');
            });
            document.getElementById('inventoryLabel').innerHTML = addRuby(Array.from(selectedInv).join('ã€') || "ãªã—");
            document.getElementById('wantLabel').innerHTML = addRuby(Array.from(selectedWant).join('ã€') || "ãªã—");
            document.getElementById('excludeLabel').innerHTML = addRuby(Array.from(selectedExclude).join('ã€') || "ãªã—");
            saveToLocal();
        }

        function renderTable() {
            let html = "";
            DAYS.forEach((day, i) => {
                const p = data.currentPlan[i];
                html += `<tr class="day-row day-row-${i}">
                    <th class="day-header">${addRuby(day)}</th>
                    <td class="menu-content">
                        <div class="drop-row">
                            ${renderBadge(i, 'main', '#f06292', 'ä¸»èœ')}
                            ${renderBadge(i, 'side', '#ffb74d', 'å‰¯èœ')}
                        </div>
                        ${renderRow(i, 'main', 'ä¸»', 'label-main')}
                        ${renderRow(i, 'side', 'å‰¯', 'label-side')}
                    </td>
                </tr>`;
            });
            document.getElementById('planBody').innerHTML = html;
            updateShoppingList();
        }

        function renderBadge(dayIdx, type, color, label) {
            const name = data.currentPlan[dayIdx][type];
            return `<span class="drop-badge" style="background-color:${name ? color : '#eee'}" onclick="openDishPicker(${dayIdx},'${type}')">
                <div class="dish-name">${addRuby(name || label + 'ãªã—')}</div>
            </span>`;
        }

        function renderRow(dayIdx, type, label, labelClass) {
            const currentName = data.currentPlan[dayIdx][type];
            const isFixed = data.currentPlan[dayIdx][type + 'Fixed'];
            return `<div class="dish-section">
                <div class="dish-header-row">
                    <span class="dish-type-label ${labelClass}">${addRuby(label)}</span>
                    <span class="fix-btn ${isFixed?'fixed':''}" onclick="toggleFix(${dayIdx},'${type}')">${addRuby(isFixed?'å›ºå®šä¸­':'æœªå›ºå®š')}</span>
                    <select class="menu-select" onchange="updateChoice(${dayIdx},'${type}',this.value)">
                        <option value="">ãªã—</option>
                        ${data[type + 's'].map(d => `<option value="${d.name}" ${d.name===currentName?'selected':''}>${d.name}</option>`).join('')}
                    </select>
                </div>
            </div>`;
        }

        function openMultiPicker(mode) {
            const overlay = document.getElementById('dishPickerOverlay');
            const grid = document.getElementById('pickerGrid');
            let items = [], selectedSet, title;
            if (mode === 'inventory') {
                items = [...new Set(['mains', 'sides', 'salads', 'soups'].flatMap(k => data[k].flatMap(d => d.ing)))].sort();
                selectedSet = selectedInv; title = "åœ¨åº«ã®é£Ÿæ";
            } else {
                items = ['mains', 'sides'].flatMap(k => data[k].map(d => d.name)).sort();
                selectedSet = (mode === 'want') ? selectedWant : selectedExclude;
                title = (mode === 'want') ? "é£Ÿã¹ãŸã„æ–™ç†" : "é£Ÿã¹ãŸããªã„æ–™ç†";
            }
            document.getElementById('pickerTitle').innerHTML = addRuby(title);
            grid.innerHTML = "";
            items.forEach(item => {
                const btn = document.createElement('div');
                btn.className = `picker-btn ${selectedSet.has(item) ? 'selected' : ''}`;
                btn.innerHTML = addRuby(item);
                btn.onclick = () => {
                    selectedSet.has(item) ? selectedSet.delete(item) : selectedSet.add(item);
                    btn.classList.toggle('selected');
                    updateLabels();
                };
                grid.appendChild(btn);
            });
            overlay.style.display = 'flex';
        }

        function updateLabels() {
            document.getElementById('inventoryLabel').innerHTML = addRuby(Array.from(selectedInv).join('ã€') || "ãªã—");
            document.getElementById('wantLabel').innerHTML = addRuby(Array.from(selectedWant).join('ã€') || "ãªã—");
            document.getElementById('excludeLabel').innerHTML = addRuby(Array.from(selectedExclude).join('ã€') || "ãªã—");
        }

        function updateChoice(i, type, val) { data.currentPlan[i][type] = val; renderTable(); saveToLocal(); }
        function toggleFix(i, type) { data.currentPlan[i][type + 'Fixed'] = !data.currentPlan[i][type + 'Fixed']; renderTable(); saveToLocal(); }
        function toggleCompact() { document.getElementById('planCard').classList.toggle('compact-mode'); renderTable(); }
        function addDish(t) { const n = document.getElementById('addName').value; if(n){data[t+'s'].push({name:n, ing:[]}); renderAll(); renderTable();} }
        function deleteDish(t, i) { data[t+'s'].splice(i, 1); renderAll(); renderTable(); }
        function openDishPicker(dayIdx, type) { openMultiPicker('want'); } // ç°¡æ˜“ç‰ˆ
        function closeDishPicker() { document.getElementById('dishPickerOverlay').style.display = 'none'; }
        function saveToLocal() { localStorage.setItem(STORAGE_KEY_DATA, JSON.stringify(data)); }
        function updateShoppingList() {
            let html = "";
            data.currentPlan.forEach(p => { if(p.main) html += `<li>${addRuby(p.main)}ã®ææ–™</li>`; });
            document.getElementById('shoppingListBody').innerHTML = html;
        }

        renderAll(); renderTable();
    </script>
</body>
</html>
